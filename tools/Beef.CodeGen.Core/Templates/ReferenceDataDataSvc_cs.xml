<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) Avanade. Licensed under the MIT License. See https://github.com/Avanade/Beef -->
<Template OutputGenDirName="Generated" OutputFileName="ReferenceDataDataSvc.cs">
  <Header>
    <![CDATA[/*
 * This file is automatically generated; any changes will be lost. 
 */

#nullable enable
#pragma warning disable IDE0005 // Using directive is unnecessary; are required depending on code-gen options

using System;
using System.Collections.Generic;
using System.Data;
using System.Text;
using Beef;
using Beef.Business;
using Beef.RefData;
using Beef.RefData.Caching;
using {{Config.Company}}.{{Config.AppName}}.Business.Data;
]]>
    <If Condition="Config.RefDataNamespace != null">
      <![CDATA[using RefDataNamespace = {{Config.RefDataNamespace}};
]]>
    </If>
    <If Condition="Config.RefDataBusNamespace != null">
      <![CDATA[using RefDataBusNamespace = {{Config.RefDataBusNamespace}};
]]>
    </If>
    <![CDATA[
namespace {{Config.Company}}.{{Config.AppName}}.Business.DataSvc
{
    /// <summary>
    /// Provides the <b>ReferenceData</b> data services.
    /// </summary>
    public static class ReferenceDataDataSvc
    {
        private static readonly Dictionary<Type, object> cacheDict = new Dictionary<Type, object>();

        /// <summary>
        /// Initializes static members of the <see cref="ReferenceDataDataSvc" /> class.
        /// </summary>
        static ReferenceDataDataSvc()
        {
]]>
  </Header>
  <Entity Condition="Entity.RefDataType != null and Entity.ExcludeDataSvc == false and Entity.ExcludeAll == false">
    <Set Name="Entity.EntityName" Condition="Config.RefDataNamespace == null" Value="${{Entity.Name}}" Otherwise="$RefDataNamespace.{{Entity.Name}}" />
    <Set Name="Entity.EntityCollectionName" Condition="Config.RefDataNamespace == null" Value="${{Entity.Name}}Collection" Otherwise="$RefDataNamespace.{{Entity.Name}}Collection" />
    <![CDATA[            cacheDict.Add(typeof({{Entity.EntityName}}), new ]]>
    <If Condition="Config.RefDataCache == null">
      <Then><![CDATA[ReferenceDataCache]]></Then>
      <Else><![CDATA[{{Config.RefDataCache}}]]></Else>
    </If>
    <![CDATA[<{{Entity.EntityCollectionName}}, ]]>
    <If Condition="Config.UseEntityData == true">
      <Then>
        <![CDATA[{{Entity.EntityName}}>(() => DataSvcInvoker.Default.InvokeAsync(typeof(ReferenceDataDataSvc), () => Factory.Create<I{{Entity.Name}}Data>().GetAllAsync())));
]]>
      </Then>
      <Else>
        <![CDATA[{{Entity.EntityName}}>(() => DataSvcInvoker.Default.InvokeAsync(typeof(ReferenceDataDataSvc), () => Factory.Create<IReferenceDataData>().{{Entity.Name}}GetAllAsync())));
]]>
      </Else>
    </If>
  </Entity>
  <Footer>
    <![CDATA[        }

        /// <summary>
        /// Gets the <see cref="IReferenceDataCollection"/> for the associated <see cref="ReferenceDataBase"/> <see cref="Type"/>.
        /// </summary>
        /// <param name="type">The <see cref="ReferenceDataBase"/> type associated </param>
        /// <returns>A <see cref="IReferenceDataCollection"/>.</returns>
        public static IReferenceDataCollection GetCollection(Type type)
        {
            if (type == null)
                throw new ArgumentNullException(nameof(type));

            if (!cacheDict.ContainsKey(type))
                throw new ArgumentException($"Type {type.Name} does not exist within the ReferenceDataDataSvc cache.", nameof(type));

            IReferenceDataCache rdc = (IReferenceDataCache)cacheDict[type];
            return rdc.GetCollection();
        }
    }
}

#pragma warning restore IDE0005
#nullable restore]]>
  </Footer>
</Template>