<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) Avanade. Licensed under the MIT License. See https://github.com/Avanade/Beef -->
<Template OutputGenDirName="Generated" OutputFileName="{{Config.Company:ToCamelCase}}.{{Config.AppName:ToCamelCase}}.proto">
  <If Condition="Config.Grpc == true">
    <![CDATA[/*
 * This file is automatically generated; any changes will be lost. 
 */

syntax = "proto3";
package {{Config.Company:ToCamelCase}}.{{Config.AppName:ToCamelCase}}.common.grpc.proto;
import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

/*
* Common...
*/

message PagingArgs {
  int64 skip = 1;
  int64 take = 2;
  bool getCount = 3;
}

message PagingResult {
  int64 skip = 1;
  int64 take = 2;
  google.protobuf.Int64Value totalCount = 3;
}

message ChangeLog {
  google.protobuf.Timestamp createdDate = 1;
  google.protobuf.StringValue createdBy = 2;
  google.protobuf.Timestamp updatedDate = 3;
  google.protobuf.StringValue updatedBy = 4;
}

message DateOnly {
  int32 year = 1;
  int32 month = 2;
  int32 day = 3;
}

message Decimal {
  int64 units = 1; // Whole units part of the amount
  sfixed32 nanos = 2; // Nano units of the amount (10^-9); must be same sign as units
}

/*
* Messages...
*/
]]>
    <Entity Condition="Entity.Grpc == true">
      <![CDATA[
message {{Entity.Name}} {
]]>
      <Property Condition="Property.GrpcFieldNo != null">
        <If Condition="Property.GrpcType == null">
          <Set Name="System.Type" Condition="Property.RefDataType == null" Value="Property.Type" Otherwise="Property.RefDataType" />
          <Switch Value="System.Type">
            <Case Value="'string'">
              <Set Name="Property.GrpcType" Value="'google.protobuf.StringValue'"/>
            </Case>
            <Case Value="'bool'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'bool'" Otherwise="'google.protobuf.BoolValue'"/>
            </Case>
            <Case Value="'double'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'double'" Otherwise="'google.protobuf.DoubleValue'"/>
            </Case>
            <Case Value="'float'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'float'" Otherwise="'google.protobuf.FloatValue'"/>
            </Case>
            <Case Value="'int'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'sint32'" Otherwise="'google.protobuf.Int32Value'"/>
            </Case>
            <Case Value="'long'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'sint64'" Otherwise="'google.protobuf.Int64Value'"/>
            </Case>
            <Case Value="'uint'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'uint64'" Otherwise="'google.protobuf.UInt32Value'"/>
            </Case>
            <Case Value="'ulong'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'uint64'" Otherwise="'google.protobuf.UInt64Value'"/>
            </Case>
            <!-- short not natively supported. -->
            <Case Value="'short'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'sint32'" Otherwise="'google.protobuf.Int32Value'"/>
            </Case>
            <!-- short not natively supported. -->
            <Case Value="'ushort'">
              <Set Name="Property.GrpcType" Condition="Property.Nullable == false" Value="'uint32'" Otherwise="'google.protobuf.UInt32Value'"/>
            </Case>
            <Case Value="'byte[]'">
              <Set Name="Property.GrpcType" Value="'bytes'"/>
            </Case>
            <Case Value="'Guid'">
              <Set Name="Property.GrpcType" Value="'google.protobuf.StringValue'"/>
            </Case>
            <Case Value="'Decimal'">
              <Set Name="Property.GrpcType" Value="'Decimal'"/>
            </Case>            
            <Case Value="'DateTime'">
              <If Condition="Property.DateTimeTransform != 'DateOnly'">
                <Then>
                  <Set Name="Property.GrpcType" Value="'google.protobuf.Timestamp'"/>
                </Then>
                <Else>
                  <Set Name="Property.GrpcType" Value="'DateOnly'"/>
                </Else>
              </If>
            </Case>
            <Case Value="'TimeSpan'">
              <Set Name="Property.GrpcType" Value="'google.protobuf.Duration'"/>
            </Case>
            <Default>
              <Set Name="Property.GrpcType" Value="Property.Type"/>
            </Default>
          </Switch>
        </If>
        <![CDATA[  ]]>
        <If Condition="Property.RefDataType != null and Property.RefDataList == true">
          <![CDATA[repeated ]]>
        </If>
        <![CDATA[{{Property.GrpcType}} {{Property.ArgumentName}} = {{Property.GrpcFieldNo}};
]]>
      </Property>
      <![CDATA[}
]]>
      <If Condition="Entity.Collection == true">
        <![CDATA[
message {{Entity.Name}}Collection {
  repeated {{Entity.Name}} items = 1;
}
]]>
      </If>
      <If Condition="Entity.CollectionResult == true">
        <![CDATA[
message {{Entity.Name}}CollectionResult {
  repeated {{Entity.Name}} result = 1;
  PagingResult paging = 2;
}
]]>
      </If>
    </Entity>
    <![CDATA[
/*
* Services...
*/
]]>
    <Entity Condition="Entity.Grpc == true">
      <Set Name="System.Bracket" Value="false"/>
      <Operation Condition="Operation.Grpc == true">
        <Set Name="System.Bracket" Value="true"/>
        <If Condition="System.Index == 0">
          <![CDATA[
service {{Entity.Name}}GrpcService {
]]>
        </If>
        <![CDATA[  rpc {{Operation.Name}} ({{Entity.Name}}{{Operation.Name}}Request) returns (]]>
        <If Condition="Operation.OperationType == 'Get' or Operation.OperationType == 'Create' or Operation.OperationType == 'Update'">
          <If Condition="Operation.ReturnType == 'void'">
            <Then><![CDATA[{{Entity.Name}}]]></Then>
            <Else><![CDATA[{{Operation.ReturnType}}]]></Else>
          </If>
        </If>
        <If Condition="Operation.OperationType == 'GetColl'">
          <If Condition="Operation.ReturnType == 'void'">
            <Then><![CDATA[{{Entity.Name}}CollectionResult]]></Then>
            <Else><![CDATA[{{Operation.ReturnType}}CollectionResult]]></Else>
          </If>
        </If>
        <If Condition="Operation.OperationType == 'Delete'">
          <![CDATA[google.protobuf.Empty]]>
        </If>
        <If Condition="Operation.OperationType == 'Custom'">
          <If Condition="Operation.ReturnType == 'void'">
            <Then><![CDATA[google.protobuf.Empty]]></Then>
            <Else><![CDATA[{{Operation.ReturnType}}]]></Else>
          </If>
        </If>
        <![CDATA[);
]]>
      </Operation>
      <If Condition="System.Bracket == true">
        <![CDATA[}]]>
      </If>
      <Operation Condition="Operation.Grpc == true">
        <![CDATA[

message {{Entity.Name}}{{Operation.Name}}Request {
]]>
        <Set Name="System.Counter" Value="0" />
        <If Condition="Operation.OperationType == 'Create' or Operation.OperationType == 'Update'">
          <![CDATA[  {{Entity.Name}} value = 1;
]]>
          <Set Name="System.Counter" Value="1" />
        </If>
        <Parameter>
          <Increment Name="System.Counter" />
          <If Condition="Parameter.GrpcType == null">
            <Set Name="System.Type" Condition="Parameter.RefDataType == null" Value="Parameter.Type" Otherwise="Parameter.RefDataType" />
            <Switch Value="System.Type">
              <Case Value="'string'">
                <Set Name="Parameter.GrpcType" Value="'google.protobuf.StringValue'"/>
              </Case>
              <Case Value="'bool'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'bool'" Otherwise="'google.protobuf.BoolValue'"/>
              </Case>
              <Case Value="'double'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'double'" Otherwise="'google.protobuf.DoubleValue'"/>
              </Case>
              <Case Value="'float'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'float'" Otherwise="'google.protobuf.FloatValue'"/>
              </Case>
              <Case Value="'int'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'sint32'" Otherwise="'google.protobuf.Int32Value'"/>
              </Case>
              <Case Value="'long'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'sint64'" Otherwise="'google.protobuf.Int64Value'"/>
              </Case>
              <Case Value="'uint'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'uint64'" Otherwise="'google.protobuf.UInt32Value'"/>
              </Case>
              <Case Value="'ulong'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'uint64'" Otherwise="'google.protobuf.UInt64Value'"/>
              </Case>
              <!-- short not natively supported. -->
              <Case Value="'short'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'sint32'" Otherwise="'google.protobuf.Int32Value'"/>
              </Case>
              <!-- short not natively supported. -->
              <Case Value="'ushort'">
                <Set Name="Parameter.GrpcType" Condition="Parameter.Nullable == false" Value="'uint32'" Otherwise="'google.protobuf.UInt32Value'"/>
              </Case>
              <Case Value="'byte[]'">
                <Set Name="Parameter.GrpcType" Value="'bytes'"/>
              </Case>
              <Case Value="'Guid'">
                <Set Name="Parameter.GrpcType" Value="'google.protobuf.StringValue'"/>
              </Case>
              <Case Value="'DateTime'">
                <If Condition="Parameter.DateTimeTransform != 'DateOnly'">
                  <Then>
                    <Set Name="Parameter.GrpcType" Value="'google.protobuf.Timestamp'"/>
                  </Then>
                  <Else>
                    <Set Name="Parameter.GrpcType" Value="'DateOnly'"/>
                  </Else>
                </If>
              </Case>
              <Case Value="'TimeSpan'">
                <Set Name="Parameter.GrpcType" Value="'google.protobuf.Duration'"/>
              </Case>
              <Default>
                <Set Name="Parameter.GrpcType" Value="Parameter.Type"/>
              </Default>
            </Switch>
          </If>
          <![CDATA[  {{Parameter.GrpcType}} {{Parameter.ArgumentName}} = {{System.Counter}};
]]>
        </Parameter>
        <If Condition="Operation.PagingArgs == true">
          <![CDATA[  PagingArgs Paging = 88;
]]>
        </If>
        <![CDATA[}]]>
      </Operation>
    </Entity>
  </If>
</Template>