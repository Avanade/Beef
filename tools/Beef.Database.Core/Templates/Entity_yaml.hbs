{{! Copyright (c) Avanade. Licensed under the MIT License. See https://github.com/Avanade/Beef }}
entities:
{{#each RefDataTables}}
  {{#if @first}}
# The following is identified as Reference Data and as such has been formatted for usage in: refdata.beef-5.yaml
  {{/if}}
- { name: {{DotNetName}}, refDataType: {{#each PrimaryKeyColumns}}{{DotNetType}}{{/each}}, collection: true, webApiRoutePrefix: {{camel PluralName}}, autoImplement: EntityFramework, entityFrameworkModel: EfModel.{{DotNetName}} }
{{/each}}
{{#each StandardTables}}
  {{#ifne ../RefDataTables.Count 0}}
    {{#if @first}}

    {{/if}}
  {{/ifne}}
  {{#if @first}}
# The following is identified as Master/Transaction Data and as such has been formatted for usage in: entity.beef-5.yaml
  {{/if}}
- { name: {{DotNetName}}, collection: true, {{#if IncludeCrud}}collectionResult: true, validator: {{DotNetName}}Validator, webApiRoutePrefix: {{camel PluralName}}, get: true, create: true, update: true, patch: true, {{/if}}autoImplement: EntityFramework, entityFrameworkModel: EfModel.{{DotNetName}},
    properties: [
  {{#each PrimaryKeyColumns}}
      { name: {{#ifeq ../PrimaryKeyColumns.Count 1}}Id{{else}}{{DotNetCleanedName}}{{/ifeq}}, type: {{DotNetType}}, text: '{{DbTable.DotNetName}} identifier', primaryKey: true, dataName: {{Name}}{{#if IsIdentity}}, dataAutoGenerated: true{{/if}} },
  {{/each}}
  {{#each StandardColumns}}
      { name: {{DotNetCleanedName}}{{#if IsJsonContent}}, type: {{DotNetCleanedName}}{{else}}{{#if IsRefData}}, type: ^{{DotNetCleanedName}}{{else}}{{#ifne DotNetType 'string'}}, type: {{#if IsNullable}}'{{DotNetType}}?'{{else}}{{DotnetType}}{{/if}}{{/ifne}}{{/if}}{{/if}}{{#ifne DotNetCleanedName Name }}, dataName: {{Name}}{{/ifne}}{{#if IsJsonContent}}, dataConverter: 'ObjectToJsonConverter{T}', entityFrameworkMapper: Set{{/if}} }{{#if @last}}{{#ifor ../HasAuditColumns ../RowVersionColumn}},{{/ifor}}{{else}},{{/if}}
  {{/each}}
  {{#if RowVersionColumn}}
      { name: ETag }{{#if HasAuditColumns}},{{/if}}
  {{/if}}
  {{#if HasAuditColumns}}
      { name: ChangeLog, type: ChangeLog }
  {{/if}}
    ]{{#if IncludeGetByArgs}},{{/if}}
  {{#if IncludeGetByArgs}}
    operations: [     
      { name: GetByArgs, type: GetColl, paging: true,
        parameters: [
          { name: Args, type: {{DotNetName}}Args, validator: {{DotNetName}}ArgsValidator }
        ]
      }
    ]
  }

- { name: {{DotNetName}}Args,
    properties: [
      { name: FooBar }
    ]
  {{/if}}
  }
  {{#unless @last}}

  {{/unless}}
{{/each}}
{{#each StandardTables}}

  {{#if @first}}
validation:
  {{/if}}
- {{camel DotNetName}}: |
     public class {{DotNetName}}Validator : Validator<{{DotNetName}}>
     {
         public {{DotNetName}}Validator()
         {
    {{#each PrimaryKeyColumns}}
             Property(x => x.{{DotNetCleanedName}}){{#unless IsIdentity}}.Mandatory(){{/unless}}{{#if IsRefData}}.IsValid(){{else}}{{#ifeq DotNetType 'string'}}{{#if HasLength}}.String({{Length}}){{/if}}{{/ifeq}}{{/if}};
    {{/each}}
    {{#each StandardColumns}}
             Property(x => x.{{DotNetCleanedName}}){{#unless IsNullable}}.Mandatory(){{/unless}}{{#if IsRefData}}.IsValid(){{else}}{{#ifeq DotNetType 'string'}}{{#if IsJsonContent}}.Entity(?){{else}}{{#if HasLength}}.String({{Length}}){{/if}}{{/if}}{{/ifeq}}{{/if}};
    {{/each}}
         }
     }
  {{#if IncludeGetByArgs}}

- {{camel DotNetName}}Args: |
     public class {{DotNetName}}ArgsValidator : Validator<{{DotNetName}}Args>
     {
         public {{DotNetName}}ArgsValidator()
         {
             Property(x => x.FooBar).Mandatory();
         }
     }
  {{/if}}
{{/each}}